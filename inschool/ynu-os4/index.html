<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>YNU 操作系统课程期末复习 Part 4 &middot; Pat~ Pat~ Meow~</title>
  <meta name="description" content="操作系统课程期末复习 Part 4 设备与数据" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://www.kmahyyg.xyz/css/main.min.css" />
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123948588-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  <style>
    body {
      background: #ecedef url("https://alicdn.kmahyyg.xyz/asset_files/aether/bgimg.webp") repeat;
    }
  </style>
</head>
  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://www.kmahyyg.xyz/" class="nav-text">Patrick Young</a></h1>
  <div class="hamburger-menu">
    <button onclick="hamburgerMenuPressed.call(this)" aria-haspopup="true" aria-expanded="false" aria-controls="menu" aria-label="Menu">
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://www.kmahyyg.xyz/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://www.kmahyyg.xyz/express-page/" class="hamburger-menu-overlay-link">Express Inc</a></li>
      <li><a href="https://www.kmahyyg.xyz/about-me-page/" class="hamburger-menu-overlay-link">About</a></li>
      <li><a href="https://www.kmahyyg.xyz/archlinux-bug-page/" class="hamburger-menu-overlay-link">Arch Linux</a></li>
      <li><a href="https://www.kmahyyg.xyz/donate-page/" class="hamburger-menu-overlay-link">Donate</a></li>
      <li><a href="https://www.kmahyyg.xyz/categories/code" class="hamburger-menu-overlay-link">Code</a></li><li><a href="https://www.kmahyyg.xyz/categories/life" class="hamburger-menu-overlay-link">Life</a></li><li><a href="https://www.kmahyyg.xyz/categories/network" class="hamburger-menu-overlay-link">Network</a></li><li><a href="https://www.kmahyyg.xyz/categories/school" class="hamburger-menu-overlay-link">School</a></li><li><a href="https://www.kmahyyg.xyz/categories/tech" class="hamburger-menu-overlay-link">Tech</a></li>
    </ul>
  </div>
</nav>
    <main class="content side-text-padding">
      <article class="post ">
        <header class="post-header">
        	<h1 class="post-title">YNU 操作系统课程期末复习 Part 4</h1>
          <p class="post-date">Posted <time datetime="2019-07-10">Jul 10, 2019</time></p>
        </header>
        
        <picture class="post-figure">
            
            <source srcset="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_school.webp">
          <img src="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_school.webp" >
        </picture>
        
        

<h1 id="操作系统">操作系统</h1>

<p>Part 3 设备与数据</p>

<h1 id="设备管理">设备管理</h1>

<p>计算机中除了 CPU 和 内存储器之外的所有设备称为外部设备。</p>

<p>按照交互对象可以分为：人机交互设备、与其他电子设备交互的设备、通信设备</p>

<p>按照使用特性可以分为：存储设备、输入输出设备、终端设备、脱机设备</p>

<p>按从属关系分为：系统设备、用户设备</p>

<p>按信息的交换单位分为：块设备和字符设备</p>

<p>设备管理的任务：</p>

<ul>
<li>选择和分配输入输出设备以便进行 IO 操作</li>
<li>控制输入输出设备和 CPU（or 内存）间交换数据</li>
<li>提供用户接口，分离软硬件</li>
<li>提高设备与CPU、进程之间的并行操作度，使操作系统获得最佳效率</li>
</ul>

<p>设备管理的功能：</p>

<ul>
<li>提供设备和管理功能接口</li>
<li>进行设备分配，实现 设备、CPU、进程间的并行操作</li>
<li>进行缓冲区管理</li>
</ul>

<h2 id="数据传送的控制方式">数据传送的控制方式</h2>

<p>控制设备和CPU（or 内存）之间的数据传送是设备管理的主要任务之一。</p>

<p>选择和衡量数据传送控制方式的原则：</p>

<ul>
<li>速度快，满足用户需要却又不丢失数据</li>
<li>系统开销小，处理控制程序少</li>
<li>充分发挥硬件资源、I/O进程尽量忙，CPU 等待时间尽量少</li>
</ul>

<h3 id="程序直接控制方式">程序直接控制方式</h3>

<p>用户进程直接控制内存或 CPU 与外部设备之间的数据传送。</p>

<p>过程：用户进程需要数据 (-&gt; 将数据放入 CPU 与外设之间的缓冲寄存器) -&gt; 向 CPU 发出 start，启动外设准备 -&gt; CPU 测试检查描述外围设备工作状态的控制状态寄存器，准备工作完成好，置寄存器为完成 -&gt; CPU 检测到 Done，开始传送</p>

<p>优点：实现简单、硬件支持少</p>

<p>缺点：</p>

<ul>
<li>CPU 与外设之间只能串行工作，传输速度慢</li>
<li>一段时间内只能一对一工作</li>
<li>依靠测试设备标志寄存器的状态位控制数据传送，无法处理和检测传送异常</li>
</ul>

<h3 id="中断控制方式">中断控制方式</h3>

<p>前提：CPU 与设备（设备控制器）之间存在相应的中断请求线，在设备控制器的控制状态寄存器中有相应的中断允许位。</p>

<p>过程：用户进程需要数据 (-&gt; 将数据放入 CPU 与外设之间的缓冲寄存器) -&gt; 向 CPU 发出 start，启动外设准备，打开中断允许位 -&gt; 发出指令启动设备，进程放弃处理器，等待输入完成 -&gt; 缓冲寄存器满，发出中断信号，转向中断处理程序进行数据传送 -&gt; 等待调度程序选中得到数据的进程以继续工作</p>

<p>优点：设备与设备、设备与 CPU 之间并行操作，CPU 利用率大大提高</p>

<p>缺点：</p>

<ul>
<li>缓冲寄存器较小，一次传输可能需要多次中断</li>
<li>较多外围设备并行时，中断次数急剧增大，可能出现 CPU 无法响应或数据丢失</li>
<li>外围设备速度非常快时，可能造成数据缓冲寄存器的数据由于 CPU 来不及取走而丢失</li>
</ul>

<h3 id="dma-direct-memory-access">DMA(Direct Memory Access)</h3>

<p>直接存储器存取，开通内存与外设之间的直接数据交换通路。</p>

<p>硬件准备：控制状态寄存器、数据缓冲寄存器、传送字节计数器、内存地址寄存器，挪用 CPU 的一个工作周期将数据从缓冲寄存器直接送到内存地址寄存器中所指向的内存区域。只在开始时需要发出启动指令和传送结束时需要通知 CPU 进行中断处理。</p>

<p>过程：准备输入数据的内存起始地址和传送字节数传入内存地址寄存器、传送字节计数器 -&gt; 控制状态寄存器中中断允许和启动位置 1-&gt; 启动外设，进程等待 -&gt; 输入设备不断挪用 CPU 工作周期，将缓存中的数据不断写入内存直至传送完毕 -&gt; 发送中断信号，调用中断处理程序，返回被中断进程</p>

<p>传输过程由 DMA 控制器完成。</p>

<p>优点：大幅提高 CPU 利用率，不会造成大量外设并发而导致的数据丢失或来不及处理</p>

<p>缺点：</p>

<ul>
<li>DMA 对外设的管理和操作仍有 CPU 控制</li>
<li>多个 DMA 同时使用会造成内存地址冲突，且不够经济</li>
</ul>

<h3 id="通道方式">通道方式</h3>

<p>数据的传送方向、存放数据的内存、数据块长度均由通道控制，一个通道控制多台设备与内存进行数据交换。</p>

<p>通道是一个独立于 CPU 的专门管理 IO 控制的处理机，控制设备与内存执行进行数据交换，指令自己独立，启动受 CPU 控制，结束发送中断。</p>

<p>硬件准备：控制状态寄存器、数据缓冲寄存器、通道设备控制器、指令执行结构。</p>

<p>CPU 只需要发出启动指令，指出相应操作和 I/O 设备即可启动通道并使通道从内存中调出相应的指令进行。通道指令由系统生成，包括操作码、读写控制、计数段、内存地址段和结束标志。</p>

<p>按照信息交换方式分为：字节多路通道（Byte-based）、数组多路通道（Block-based）、选择通道</p>

<p>数据输入过程：CPU 发 start 指明 IO 操作、设备号和对应通道 -&gt; 读取内存中的通道指令，设置对应外设在 IO 控制器中的控制状态寄存器 -&gt; 数据送往内存中的指定区域 -&gt; 传送结束，发中断，中断处理程序，返回被中断处继续执行。</p>

<h2 id="中断技术">中断技术</h2>

<p>中断分为：</p>

<p>外中断：来自 CPU 和内存之外的中断，主要有： I/O中断、时钟信号中断、外部信号中断、调试中断。</p>

<p>内中断：来自 CPU 和内存内部的中断，称为 trap，包括：程序执行错误、用户态程序执行特权指令（用户态与核心态的切换）、分时系统的时间片中断</p>

<p>中断有对应的不同优先级，PSW 中有相应的优先级，若中断源发出的优先级高于 PSW 中优先级，则响应中断，否则屏蔽中断。</p>

<h3 id="和陷阱的区别">和陷阱的区别</h3>

<ul>
<li>中断优先级在系统设计时固定，陷阱优先级根据执行情况由系统动态调整</li>
<li>陷阱由正在执行的指令引起，中断由其他指令引起，陷阱处理程序为当前程序提供服务，中断处理不为当前程序提供服务</li>
<li>指令是原子执行的，指令执行中可以相应陷阱。（部分系统中，陷阱处理在进程上下文，中断处理在系统上下文）</li>
</ul>

<h3 id="软中断">软中断</h3>

<p>通信进程用来模拟硬中断，当中断源发出请求后，CPU 或接受进程在适当时机自动完成中断处理或完成中断对应的功能。大部分陷阱处理转换为软中断执行。</p>

<h3 id="中断处理">中断处理</h3>

<p>判断中断响应条件 -&gt; 关中断 -&gt; 保护被中断现场 -&gt; 寻找中断原因，转中断处理 -&gt; 执行中断处理 -&gt; 恢复中断现场 -&gt; 开中断 -&gt; 返回中断点</p>

<h2 id="缓冲技术">缓冲技术</h2>

<p>匹配外设与 CPU 处理素段，减少中断次数、解决 DMA 和通道方式的瓶颈，引入缓冲，实现：采用专用的硬件缓冲器、在内存中划出专用缓冲区。</p>

<p>分类：</p>

<ul>
<li>单缓冲：CPU 与设备间设置一个缓冲器</li>
<li>双缓冲：一个缓冲器作为输入，一个缓冲器作为输出</li>
<li>多缓冲：多个缓冲区联系在一起，分为两部分：一部分输入，另一部分输出</li>
<li>缓冲池：多个缓冲区联系，即可输入也可输出</li>
</ul>

<h3 id="缓冲池">缓冲池</h3>

<p>结构：多个缓冲区。每个缓冲区一部分用于表示缓冲器和缓冲头部，另一部分用于存放数据的缓冲体。</p>

<p>缓冲头部：设备号、数据块号、缓冲器号、互斥标识、连接指针</p>

<p>缓冲区队列：空白队列、装满的输入缓冲队列、装满的输出缓冲队列</p>

<p>用户从这三种队列取出缓冲区，进行IO操作后放入相应队列，这些缓冲区称为工作缓冲区</p>

<p>工作缓冲区包括：</p>

<ul>
<li>收容输入缓冲区 hin、收容输出缓冲区 hout</li>
<li>提取输入缓冲区 sin、提取输出缓冲区 sout</li>
</ul>

<p>存取过程包括：take_buf 选取、get_buf 申请、put_buf 放回队列、add_buf 插入队列</p>

<p>进程对缓冲队列的访问应当是同步的，对缓冲区的访问应当是互斥的</p>

<h2 id="设备分配">设备分配</h2>

<p>进程向设备管理提出申请 -&gt; 分配资源，否则放入资源等待队列等待资源被释放。</p>

<h3 id="dct-device-control-table">DCT - Device Control Table</h3>

<p>每设备一张，反馈设备特性与 IO 链接情况。</p>

<p>包括：设备标识符、设备类型、设备地址/设备号、设备状态、等待队列指针、IO控制器指针</p>

<h3 id="sdt-system-device-table">SDT - System Device Table</h3>

<p>每系统一张，记录物理设备情况。包括：DCT指针，正在使用设备的进程标识，设备类型与设备标识符。</p>

<h3 id="coct-controller-control-table">COCT - Controller Control Table</h3>

<p>每个控制器一张，反应IO控制器使用状态和通道的链接情况，DMA方式下不存在。</p>

<p>包括：控制器标识、忙碌标记、CHCT 指针、等待队列指针</p>

<h3 id="chct-channel-control-table">CHCT - Channel Control Table</h3>

<p>只在通道控制方式的系统中存在，每通道一张，包括：通道标识符、忙碌标识、等待通道的进程队列指针。</p>

<h3 id="分配">分配</h3>

<p>原则：设备尽可能忙碌，但不能造成进程死锁；用户程序和物理设备隔离。</p>

<p>方式：静态分配（开始执行前一次分配完毕）；动态分配（执行时按需分配）。</p>

<p>策略：FCFS，优先级高分配</p>

<h2 id="i-o-控制">I/O 控制</h2>

<p>从进程提出输入输出请求开始，给用户进程分配设备并启动设备完成 IO 操作，完成后响应中断，进行善后处理的整个系统控制过程称为 IO 控制。</p>

<p>请求包括：逻辑设备名、要求操作、传送数据长度、起始地址。</p>

<p>请求控制模块：逻辑设备转换为物理设备 -&gt; 检查请求参数 -&gt; 插入 DCT 对应等待队列并启动设备分配程序，编制通道程序 -&gt; 启动缓冲管理模块分配相应缓冲区。</p>

<p>控制过程实现：</p>

<ul>
<li>作为请求 IO 操作进程的一部分实现</li>
<li>作为当前进程的一部分实现</li>
<li>由专门的系统 IO 进程完成</li>
</ul>

<p>专门化的 IO 进程：</p>

<ul>
<li>每类设备专门 IO 进程，系统态 / 用户态</li>
<li>整系统一个 IO 进程，负责系统的数据传送</li>
</ul>

<h3 id="spooling-伪脱机">Spooling 伪脱机</h3>

<p>Spooling 是指假脱机技术，使独占设备变为可共享的设备的虚拟设备技术。其利用大容量、快速、可被共享的磁盘设备作为中介，模拟多个非共享的字符数入输出设备。需要独占设备的进程不再直接与该设备交互，取而代之的是与该虚拟设备交互，虚拟设备和物理设备则在系统特设的假脱机进程控制下进行信息传输。</p>

<h2 id="设备驱动程序管理">设备驱动程序管理</h2>

<p>设备驱动程序是驱动物理设备和 DMA / IO控制器等直接进行 IO 操作的子程序的集合。负责设置寄存器值、启动设备进行 IO，指定操作类型与数据流向。</p>

<p>数据结构： Device Switch Table (DST 设备开关表)</p>

<p>DST 是 IO 进程的一个数据结构，给出各种相应设备的子程序的入口地址。IO 进程为进程分配设备和缓冲区，调用 DST 中对应的驱动程序进行 IO 操作。</p>

      </article>
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kmahyyg" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://www.kmahyyg.xyz/inschool/ynu-os3/" class="card blog-card" rel="bookmark" >
    
    <div class="card-img-container">
      <p class="card-img-overlay">Next Article</p>
      <picture>
        
        <source srcset="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_school.webp">
        <img src="https://alicdn.kmahyyg.xyz/asset_files/aether/cat_school.webp" class="card-img" >
      </picture>
    </div>
    
  <article class="card-body">
    <h2 class="card-title">YNU 操作系统课程期末复习 Part 3</h2>
    <p class="card-text">操作系统课程期末复习 Part 3 文件系统</p>
    <div class="card-subtext muted-text">
      <p>Posted <time datetime="2019-07-10 710:00">Jul 10, 2019</time></p>
      <p>#school </p>
    </div>
  </article>
</a>
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://www.kmahyyg.xyz/" class="card home-card" style="background-image: url( https://alicdn.kmahyyg.xyz/asset_files/aether/backtohome.webp )" rel="bookmark" >
  Home
</a>
    </nav>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<script src="https://www.kmahyyg.xyz/js/core.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
  </body>
</html>